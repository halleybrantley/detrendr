scale_color_distiller(palette= "Spectral")
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(ggmap)
register_google(key="AIzaSyBEiKKah1y_DAPJXmizcVaZt7py8C3T_ic")
library(devtools)
library(rgdal)
library(geoR)
load_all("../Code/traxr")
rm(list=ls())
load("../Data/grid200.RData")
map <- get_map(location = c(lon = site_coords[1,2],
lat = site_coords[1,1]),
maptype = "hybrid", zoom=16)
spod_stats$time[i]
load("../Data/processed/paramfit_200m_10min_2018-06-19_j.RData")
load("../Data/processed/grid_200m_10min_2018-06-19_j.RData")
load("../Data/processed/summary_10min_2018-06-19_j.RData")
load("../Data/processed/spod_2018-06-19_j.RData")
i <- 45
spod_stats$time[i]
grid_fit <- grid100.latlon %>%
filter(layer %in% as.numeric(colnames(X)))
ggmap(map) +
geom_point(data = grid_fit,
aes(alpha=.4),
size=2, col="blue") +
geom_point(data=site_coords, aes(x=lon, y=lat),
fill="yellow", col = "black", shape=17, size = 2)+
guides(alpha="none")
grid_fit <- grid100.latlon %>%
filter(layer %in% as.numeric(colnames(X)))
ggmap(map) +
geom_point(data = grid_fit,
aes(alpha=.4),
size=2, col="blue") +
geom_point(data=site_coords[1,], aes(x=lon, y=lat),
col ="yellow", shape=17, size = 3)+
guides(alpha="none")
bplot <- gather(B, "basis", "value")
?gather
bplot <- tidyr::gather(B, "basis", "value")
bplot <- tidyr::gather(as.data.frame(B), "basis", "value")
head(bplot)
bplot <- B %>% as.data.frame() %>%
mutate(x=seq(1, nrow(B), 1)) %>%
gather("basis", "value", -x)
head(bplot)
ggplot(bplot, aes(x=x, y=y, group=basis)) +
geom_line() +
theme_bw()
bplot <- B %>% as.data.frame() %>%
mutate(x=seq(1, nrow(B), 1)) %>%
gather("basis", "value", -x)
ggplot(bplot, aes(x=x, y=y, group=basis)) +
geom_line() +
theme_bw()
ggplot(bplot, aes(x=x, y=value, group=basis)) +
geom_line() +
theme_bw()
n <- nrow(X)
bplot2 <-
bs(seq(1,n,1), df = 6, degree=3, intercept = TRUE) %>%
as.data.frame() %>%
mutate(x=seq(1, nrow(B), 1)) %>%
gather("basis", "value", -x)
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(ggmap)
register_google(key="AIzaSyBEiKKah1y_DAPJXmizcVaZt7py8C3T_ic")
library(devtools)
library(rgdal)
library(geoR)
library(splines)
load_all("../Code/traxr")
rm(list=ls())
load("../Data/grid200.RData")
map <- get_map(location = c(lon = site_coords[1,2],
lat = site_coords[1,1]),
maptype = "hybrid", zoom=16)
bplot2 <-
bs(seq(1,n,1), df = 6, degree=3, intercept = TRUE) %>%
as.data.frame() %>%
mutate(x=seq(1, nrow(B), 1)) %>%
gather("basis", "value", -x)
n
n <- nrow(X)
bplot2 <-
bs(seq(1,n,1), df = 8, degree=3, intercept = TRUE) %>%
as.data.frame() %>%
mutate(x=seq(1, nrow(B), 1)) %>%
gather("basis", "value", -x)
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(ggmap)
register_google(key="AIzaSyBEiKKah1y_DAPJXmizcVaZt7py8C3T_ic")
library(devtools)
library(rgdal)
library(geoR)
library(splines)
load_all("../Code/traxr")
rm(list=ls())
load("../Data/grid200.RData")
map <- get_map(location = c(lon = site_coords[1,2],
lat = site_coords[1,1]),
maptype = "hybrid", zoom=16)
load("../Data/processed/paramfit_200m_10min_2018-06-19_j.RData")
load("../Data/processed/grid_200m_10min_2018-06-19_j.RData")
load("../Data/processed/summary_10min_2018-06-19_j.RData")
load("../Data/processed/spod_2018-06-19_j.RData")
bplot <- B %>% as.data.frame() %>%
mutate(x=seq(1, nrow(B), 1)) %>%
gather("basis", "value", -x)
ggplot(bplot, aes(x=x, y=value, group=basis)) +
geom_line() +
theme_bw() +
labs(title = "4 basis functions")
n <- nrow(X)
bplot2 <-
bs(seq(1,n,1), df = 8, degree=3, intercept = TRUE) %>%
as.data.frame() %>%
mutate(x=seq(1, nrow(B), 1)) %>%
gather("basis", "value", -x)
ggplot(bplot, aes(x=x, y=value, group=basis)) +
geom_line() +
theme_bw() +
labs(title = "8 basis functions")
bplot <- B %>% as.data.frame() %>%
mutate(x=seq(1, nrow(B), 1)) %>%
gather("basis", "value", -x)
ggplot(bplot, aes(x=x, y=value, group=basis)) +
geom_line() +
theme_bw() +
labs(title = "4 basis functions")
n <- nrow(X)
bplot2 <-
bs(seq(1,n,1), df = 8, degree=3, intercept = TRUE) %>%
as.data.frame() %>%
mutate(x=seq(1, nrow(B), 1)) %>%
gather("basis", "value", -x)
ggplot(bplot2, aes(x=x, y=value, group=basis)) +
geom_line() +
theme_bw() +
labs(title = "8 basis functions")
bplot <- B %>% as.data.frame() %>%
mutate(x=seq(1, nrow(B), 1)) %>%
gather("basis", "value", -x)
ggplot(bplot, aes(x=x, y=value, group=basis)) +
geom_line() +
theme_bw() +
labs(title = "4 basis functions")
n <- nrow(X)
bplot2 <-
bs(seq(1,n,1), df = 8, degree=3, intercept = TRUE) %>%
as.data.frame() %>%
mutate(x=seq(1, nrow(B), 1)) %>%
gather("basis", "value", -x)
ggplot(bplot2, aes(x=x, y=value, group=basis)) +
geom_line() +
theme_bw() +
labs(title = "8 basis functions")
dim(B)
beta1 <- c(1, 1, 0, 0)
plotdf <- data.frame(time = spod_stats$time, Q = B%*%beta1)
beta1 <- c(1, 1, 0, 0)
plotdf <- data.frame(time = spod_stats$time, Q = B%*%beta1)
ggplot(plotdf, aes(x=time, y=Q)) +
geom_line() +
theme_bw() +
title(bquote(beta=c(1,1,0,0)))
beta1 <- c(1, 1, 0, 0)
plotdf <- data.frame(time = spod_stats$time, Q = B%*%beta1)
ggplot(plotdf, aes(x=time, y=Q)) +
geom_line() +
theme_bw() +
labs(title=bquote(beta=c(1,1,0,0)))
ggplot(plotdf, aes(x=time, y=Q)) +
geom_line() +
theme_bw() +
labs(title=expression(beta=c(1,1,0,0)))
ggplot(plotdf, aes(x=time, y=Q)) +
geom_line() +
theme_bw() +
labs(title=expression(beta"=(1,1,0,0)"))
beta1 <- c(1, 1, 0, 0)
plotdf <- data.frame(time = spod_stats$time, Q = B%*%beta1)
ggplot(plotdf, aes(x=time, y=Q)) +
geom_line() +
theme_bw() +
labs(title=expression(beta~"=(1,1,0,0)"))
B8 <- bs(seq(1,n,1), df = 8, degree=3, intercept = TRUE)
beta2 <- c(1, 1, 0, 0, 1, 1, 0, 0)
plotdf <- data.frame(time = spod_stats$time, Q = B8%*%beta2)
ggplot(plotdf, aes(x=time, y=Q)) +
geom_line() +
theme_bw() +
labs(title=expression(beta~"=(1, 1, 0, 0, 1, 1, 0, 0)"))
beta1 <- c(1, 1, 0, 0)
plotdf <- data.frame(time = spod_stats$time, Q = B%*%beta1)
ggplot(plotdf, aes(x=time, y=Q)) +
geom_line() +
theme_bw() +
labs(title=expression(beta~"=(1,1,0,0)"))
beta2 <- c(1, 1, 0, 0, 1, 1, 0, 0)
plotdf <- data.frame(time = spod_stats$time, Q = B8%*%beta2)
ggplot(plotdf, aes(x=time, y=Q)) +
geom_line() +
theme_bw() +
labs(title=expression(beta~"=(2, 2, 0, 0, 1, 1, 0, 0)"))
beta1 <- c(0, 0, 1, 1)
plotdf <- data.frame(time = spod_stats$time, Q = B%*%beta1)
ggplot(plotdf, aes(x=time, y=Q)) +
geom_line() +
theme_bw() +
labs(title=expression(beta~"=(0,0,1,1)"))
beta2 <- c(1, 1, 0, 0, 1, 1, 0, 0)
plotdf <- data.frame(time = spod_stats$time, Q = B8%*%beta2)
ggplot(plotdf, aes(x=time, y=Q)) +
geom_line() +
theme_bw() +
labs(title=expression(beta~"=(2, 2, 0, 0, 1, 1, 0, 0)"))
beta <- rstan::extract(param_fit, 'beta')$beta
beta <- apply(exp(beta), c(2,3), mean)
grid_fit <- grid100.latlon %>%
filter(layer %in% as.numeric(colnames(X)))
grid_fit[,c("beta1", "beta2", "beta3", "beta4")] <- beta
ggmap(map) +
geom_point(data = grid_fit,
aes(col=beta2, alpha=.5),
size=4) +
geom_point(data=site_coords, aes(x=lon, y=lat),
col="black", shape=17, size = 4)+
guides(alpha="none") +
labs(col = "Source Est.", title = expression(beta[2])) +
scale_color_distiller(palette = "Spectral")
beta
beta <- t(apply(exp(beta), c(2,3), mean))
beta <- rstan::extract(param_fit, 'beta')$beta
beta <- t(apply(exp(beta), c(2,3), mean))
grid_fit <- grid100.latlon %>%
filter(layer %in% as.numeric(colnames(X)))
grid_fit[,c("beta1", "beta2", "beta3", "beta4")] <- beta
ggmap(map) +
geom_point(data = grid_fit,
aes(col=beta1, alpha=.5),
size=4) +
geom_point(data=site_coords, aes(x=lon, y=lat),
col="black", shape=17, size = 4)+
guides(alpha="none") +
labs(col = NULL) +
scale_color_distiller(palette = "Spectral")
max(beta)
beta <- rstan::extract(param_fit, 'beta')$beta
beta <- t(apply(exp(beta), c(2,3), mean))
grid_fit <- grid100.latlon %>%
filter(layer %in% as.numeric(colnames(X)))
grid_fit[,c("beta1", "beta2", "beta3", "beta4")] <- beta
ggmap(map) +
geom_point(data = grid_fit,
aes(col=beta1, alpha=.5),
size=4) +
geom_point(data=site_coords, aes(x=lon, y=lat),
col="black", shape=17, size = 4)+
guides(alpha="none") +
labs(col = NULL, title = expression(beta[1])) +
scale_color_distiller(palette = "Spectral", limits = c(0, 4))
ggmap(map) +
geom_point(data = grid_fit,
aes(col=beta2, alpha=.5),
size=4) +
geom_point(data=site_coords, aes(x=lon, y=lat),
col="black", shape=17, size = 4)+
guides(alpha="none") +
labs(col = NULL, title = expression(beta[2])) +
scale_color_distiller(palette = "Spectral")
ggmap(map) +
geom_point(data = grid_fit,
aes(col=beta2, alpha=.5),
size=4) +
geom_point(data=site_coords[1,], aes(x=lon, y=lat),
col="black", shape=17, size = 4)+
guides(alpha="none") +
labs(col = NULL, title = expression(beta[2])) +
scale_color_distiller(palette = "Spectral")
?ggmap
mu <- rstan::extract(param_fit, 'mu')$mu
muHat <- colMeans(mu)
mu <- rstan::extract(param_fit, 'mu')$mu
muHat <- colMeans(mu)
plot(y~muHat)
knitr::opts_chunk$set(echo = TRUE)
plot_pred <- data.frame(y = y, yHat=colMeans(mu))
mu <- rstan::extract(param_fit, 'mu')$mu
plot_pred <- data.frame(y = y, yHat=colMeans(mu))
plot_pred <- plot_pred*1000/5
ggplot(plot_pred, aes(y = muHat, x = y)) +
geom_point() +
theme_bw() +
labs(x="Observed SPod Measurement", y="Predicted SPod Measurement")
mu <- rstan::extract(param_fit, 'mu')$mu
plot_pred <- data.frame(y = y, yHat=colMeans(mu))
head(plot_pred)
plot_pred*1000/5
head(plot_pred)
plot_pred <- plot_pred*1000/5
head(plot_pred)
ggplot(plot_pred, aes(y = muHat, x = y)) +
geom_point() +
theme_bw() +
labs(x="Observed SPod Measurement", y="Predicted SPod Measurement")
ggplot(plot_pred, aes(y = yHat, x = y)) +
geom_point() +
theme_bw() +
labs(x="Observed SPod Measurement", y="Predicted SPod Measurement")
ggplot(plot_pred, aes(y = yHat, x = y)) +
geom_point() +
theme_bw() +
geom_abline(0,1) +
labs(x="Observed SPod Measurement", y="Predicted SPod Measurement")
ggplot(plot_pred, aes(y = yHat, x = y)) +
geom_point() +
theme_bw() +
geom_abline(intercept=0,slope=1) +
labs(x="Observed SPod Measurement", y="Predicted SPod Measurement")
mu <- rstan::extract(param_fit, 'mu')$mu
plot_pred <- data.frame(y = y, yHat=colMeans(mu))
plot_pred <- plot_pred*1000/5
ggplot(plot_pred, aes(y = yHat, x = y)) +
geom_point() +
theme_bw() +
geom_abline(intercept=0,slope=1) +
labs(x="Observed SPod", y="Predicted SPod")
load("../Data/processed/paramfit_200m_10min_2018-06-19_j.RData")
load("../Data/processed/paramfit_200m_10min_2018-06-18_j.RData")
beta <- rstan::extract(param_fit, 'beta')$beta
beta <- t(apply(exp(beta), c(2,3), mean))
plot(as.numeric(beta))
plot(as.numeric(t(beta)))
load("../Data/processed/paramfit_200m_10min_2018-06-18_j.RData")
beta <- rstan::extract(param_fit, 'beta')$beta
beta <- t(apply(exp(beta), c(2,3), mean))
grid_fit <- grid100.latlon %>%
filter(layer %in% as.numeric(colnames(X)))
grid_fit[,c("beta1", "beta2", "beta3", "beta4")] <- beta
ggmap(map, extent = "device") +
geom_point(data = grid_fit,
aes(col=beta1, alpha=.5),
size=4) +
geom_point(data=site_coords[1,], aes(x=lon, y=lat),
col="black", shape=17, size = 4)+
guides(alpha="none") +
labs(col = NULL, title = expression(beta[1])) +
scale_color_distiller(palette = "Spectral", limits = c(0, 4))
beta_df <- beta %>% as.data.frame() %>%
mutate(k = seq(1, ncol(X), 1)) %>%
gather("basis", "value", -k)
head(beta_df)
beta <- t(apply(exp(beta), c(2,3), mean))
colnames(beta) <- c("B1", "B2", "B3", "B4")
beta <- rstan::extract(param_fit, 'beta')$beta
beta <- t(apply(exp(beta), c(2,3), mean))
colnames(beta) <- c("B1", "B2", "B3", "B4")
beta_df <- beta %>% as.data.frame() %>%
mutate(k = seq(1, ncol(X), 1)) %>%
gather("basis", "value", -k)
ggplot(beta_df, aes(x=k, y=value, col=basis)) +
geom_point() +
theme_bw()
ggplot(beta_df, aes(x=k, y=value, col=basis)) +
geom_point() +
theme_bw() +
scale_color_brewer(palette= "Set1")
ggplot(beta_df, aes(x=k, y=value, col=basis)) +
geom_point(size = basis) +
theme_bw() +
scale_color_brewer(palette= "Set1")
ggplot(beta_df, aes(x=k, y=value, col=basis)) +
geom_point(aes(size = basis)) +
theme_bw() +
scale_color_brewer(palette= "Set1")
ggplot(beta_df, aes(x=k, y=value, col=basis)) +
geom_point() +
theme_bw() +
scale_color_brewer(palette= "Set1")
ggplot(beta_df, aes(x=k, y=value, col=basis)) +
geom_point() +
theme_bw() +
facet_grid(.~basis)
ggplot(beta_df, aes(x=k, y=value, col=basis)) +
geom_point() +
theme_bw() +
facet_grid(basis~.)
grid_fit$k <- seq(1, ncol(X), 1)
install.packages("pkgdown")
setwd("~/Repositories/detrendr")
pkgdown::build_site()
getwd(0)
getwd()
library(devtools)
use_readme_rmd()
?get_trend_BIC
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>",
fig.path = "man/figures/README-",
out.width = "100%"
)
library(dtrendr)
library(detrendr)
n <- 100
x <- seq(1, n, 1)
y <- sin(x*2*pi/n) + rnorm(n, 0, .4)
lambda <- 10
k <- 3
tau <- c(0.05, .2)
trend <- get_trend(y, tau, lambda, k)
plot(trend[,1]~x, type="l")
plot(y~x, type="l", col="grey")
lines(trend[,1]~x, col="red")
library(detrendr)
n <- 100
x <- seq(1, n, 1)
y <- sin(x*2*pi/n) + rnorm(n, 0, .4)
lambda <- 10
k <- 3
tau <- c(0.05, .2)
trend <- get_trend(y, tau, lambda, k)
plot(y~x, type="l", col="grey")
lines(trend[,1]~x, col="red")
lines(trend[,2]~x, col="blue")
trend <- get_trend_BIC(y, tau, k)
trend <- get_trend_BIC(y, tau, k, plot_lambda = TRUE)
trend_fit <- get_trend_BIC(y, tau, k, plot_lambda = TRUE)
trend <- trend_fit$trend
plot(y~x, type="l", col="grey")
lines(trend[,1]~x, col="red")
library(devtools)
install_github("halleybrantely/detrendr")
install_github("halleybrantley/detrendr")
library(detrendr)
n <- 100
x <- seq(1, n, 1)
y <- sin(x*2*pi/n) + rnorm(n, 0, .4)
lambda <- 10
k <- 3
tau <- c(0.05, .2)
trend <- get_trend(y, tau, lambda, k)
plot(y~x, type="l", col="grey")
lines(trend[,1]~x, col="red")
trend_fit <- get_trend_BIC(y, tau, k, plot_lambda = TRUE)
trend <- trend_fit$trend
plot(y~x, type="l", col="grey")
lines(trend[,1]~x, col="red")
plot(y~x, type="l", col="grey")
lines(trend[,1]~x, col="red")
trend_fit <- get_trend_BIC(y, tau, k, plot_lambda = TRUE)
trend <- trend_fit$trend
plot(y~x, type="l", col="grey")
lines(trend[,1]~x, col="red")
trend_fit$trend
library(detrendr)
trend_fit <- get_trend_BIC(y, tau, k, plot_lambda = TRUE)
get_trend_BIC
install_github("halleybrantley/detrendr", force = TRUE)
library(detrendr)
install_github("halleybrantley/detrendr", force = TRUE)
library(detrendr)
remove.packages("detrendr")
getwd()
document()
load_all()
test()
check
check()
document()
check()
?Matrix
document()
build()
Rcpp::sourceCpp('src/getDk.cpp')
setwd("~/Repositories/detrendr")
library(devtools)
build()
load_all()
document()
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>",
fig.path = "man/figures/README-",
out.width = "100%"
)
n <- 100
x <- seq(1, n, 1)
y <- sin(x*2*pi/n) + rnorm(n, 0, .4)
lambda <- 10
k <- 3
tau <- c(0.05, .2)
trend <- get_trend(y, tau, lambda, k)
plot(y~x, type="l", col="grey")
lines(trend[,1]~x, col="red")
trend_fit <- get_trend_BIC(y, tau, k, plot_lambda = TRUE)
trend <- trend_fit$trend
plot(y~x, type="l", col="grey")
lines(trend[,1]~x, col="red")
trend_fit <- get_trend_BIC(y, tau, k, plot_lambda = TRUE)
trend <- trend_fit$trend
plot(y~x, type="l", col="grey")
lines(trend[,1]~x, col="red")
lines(trend[,2]~x, col="blue")
library(devtools)
install_github("halleybrantley/detrendr")
?fig.width
